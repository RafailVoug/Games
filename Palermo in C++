#include <iostream>
#include <vector>
#include <map>
#include <random>
#include <ctime>
#include <windows.h>
#include <algorithm>

struct Player {
    std::string name;
    std::string role;
    bool alive = true;
};

// Î Î±Î³ÎºÏŒÏƒÎ¼Î¹ÎµÏ‚ Î¼ÎµÏ„Î±Î²Î»Î·Ï„Î­Ï‚
std::vector<Player> players;
std::map<std::string, int> roleCount;
int totalPlayers;

// Î£Ï…Î½Î±ÏÏ„Î®ÏƒÎµÎ¹Ï‚ Ï€Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï
void setupGame();
void assignRoles();
void nightPhase();
void dayPhase();
void voteElimination();
int getRandomAlivePlayer();
void checkWinCondition();

int main() {
    SetConsoleOutputCP(CP_UTF8);
    std::cout << "ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸Î±Ï„Îµ ÏƒÏ„Î¿ Mafia Game!\n";
    
    // Î•Ï€Î¹Î»Î¿Î³Î® Î±ÏÎ¹Î¸Î¼Î¿Ï Ï€Î±Î¹ÎºÏ„ÏÎ½
    std::cout << "Î ÏŒÏƒÎ¿Î¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ Î¸Î± Ï€Î±Î¯Î¾Î¿Ï…Î½ (Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 5)?: ";
    std::cin >> totalPlayers;
    while (totalPlayers < 5) {
        std::cout << "Î ÏÎ­Ï€ÎµÎ¹ Î½Î± ÎµÎ¯Î½Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ 5! Î”Î¿ÎºÎ¹Î¼Î¬ÏƒÏ„Îµ Î¾Î±Î½Î¬: ";
        std::cin >> totalPlayers;
    }
    
    setupGame();
    assignRoles();
    
    while (true) {
        nightPhase();
        checkWinCondition();
        dayPhase();
        checkWinCondition();
    }
    
    return 0;
}

// Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Ï€Î±Î¹ÎºÏ„ÏÎ½
void setupGame() {
    players.clear();
    roleCount = { {"Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚", 1}, {"Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚", 1}, {"Î Î¿Î»Î¯Ï„Î·Ï‚", totalPlayers - 2} };

    std::cin.ignore(); // ÎšÎ±Î¸Î±ÏÎ¯Î¶ÎµÎ¹ Ï„Î¿ buffer
    for (int i = 0; i < totalPlayers; ++i) {
        std::string playerName;
        std::cout << "Î”ÏÏƒÎµ ÏŒÎ½Î¿Î¼Î± Î³Î¹Î± Ï„Î¿Î½ Î Î±Î¯ÎºÏ„Î· " << i + 1 << ": ";
        std::getline(std::cin, playerName);
        players.push_back({playerName, "", true});
    }
}

// Î‘Î½Î¬Î¸ÎµÏƒÎ· ÏÏŒÎ»Ï‰Î½
void assignRoles() {
    std::vector<std::string> availableRoles;
    for (const auto &pair : roleCount) {
        for (int i = 0; i < pair.second; ++i) {
            availableRoles.push_back(pair.first);
        }
    }
    std::shuffle(availableRoles.begin(), availableRoles.end(), std::default_random_engine(time(nullptr)));

    for (size_t i = 0; i < players.size(); ++i) {
        players[i].role = availableRoles[i];
    }

    std::cout << "\nÎŸÎ¹ ÏÏŒÎ»Î¿Î¹ Î­Ï‡Î¿Ï…Î½ Î±Î½Î±Ï„ÎµÎ¸ÎµÎ¯! (ÎœÏ…ÏƒÏ„Î¹ÎºÎ¿Î¯ ğŸ˜‰)\n";
}

// ÎÏ…Ï‡Ï„ÎµÏÎ¹Î½Î® Ï†Î¬ÏƒÎ·: ÎŸ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚ ÎµÏ€Î¹Ï„Î¯Î¸ÎµÏ„Î±Î¹
void nightPhase() {
    std::cout << "\nğŸŒ™ ÎÎ¥Î§Î¤Î‘: ÎŸ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚ Î±Ï€Î¿Ï†Î±ÏƒÎ¯Î¶ÎµÎ¹ Ï€Î¿Î¹Î¿Î½ Î¸Î± ÏƒÎºÎ¿Ï„ÏÏƒÎµÎ¹...\n";
    
    int victimIndex = getRandomAlivePlayer();
    players[victimIndex].alive = false;

    std::cout << "âŒ " << players[victimIndex].name << " ÏƒÎºÎ¿Ï„ÏÎ¸Î·ÎºÎµ!\n";
}

// Î—Î¼ÎµÏÎ®ÏƒÎ¹Î± Ï†Î¬ÏƒÎ·: ÎŸÎ¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ ÏˆÎ·Ï†Î¯Î¶Î¿Ï…Î½
void dayPhase() {
    std::cout << "\nğŸŒ ÎœÎ•Î¡Î‘: ÎŸÎ¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ ÏƒÏ…Î¶Î·Ï„Î¿ÏÎ½ ÎºÎ±Î¹ ÏˆÎ·Ï†Î¯Î¶Î¿Ï…Î½ Î³Î¹Î± Î±Ï€Î¿Î²Î¿Î»Î®!\n";
    voteElimination();
}

// Î¨Î®Ï†Î¿Ï‚ Î±Ï€Î¿Î²Î¿Î»Î®Ï‚ (Î”Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒ)
void voteElimination() {
    std::string voteName;
    std::cout << "ğŸ”º Î Î¿Î¹Î¿Î½ Î¸Î­Î»ÎµÏ„Îµ Î½Î± Î±Ï€Î¿Î²Î¬Î»ÎµÏ„Îµ; (Î³ÏÎ¬ÏˆÏ„Îµ ÏŒÎ½Î¿Î¼Î±): ";
    std::cin.ignore();
    std::getline(std::cin, voteName);

    bool found = false;
    for (auto &player : players) {
        if (player.name == voteName && player.alive) {
            player.alive = false;
            std::cout << "ğŸ—³ï¸ " << player.name << " Î±Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ!\n";
            found = true;
            break;
        }
    }

    if (!found) {
        std::cout << "âŒ Î›Î¬Î¸Î¿Ï‚ ÏŒÎ½Î¿Î¼Î±! ÎšÎ±Î½ÎµÎ¯Ï‚ Î´ÎµÎ½ Î±Ï€Î¿Î²Î»Î®Î¸Î·ÎºÎµ...\n";
    }
}

// Î•Ï€Î¹Î»Î¿Î³Î® Ï„Ï…Ï‡Î±Î¯Î¿Ï… Î¶Ï‰Î½Ï„Î±Î½Î¿Ï Ï€Î±Î¯ÎºÏ„Î·
int getRandomAlivePlayer() {
    std::vector<int> alivePlayers;
    for (size_t i = 0; i < players.size(); ++i) {
        if (players[i].alive) {
            alivePlayers.push_back(i);
        }
    }
    return alivePlayers[rand() % alivePlayers.size()];
}

// ÎˆÎ»ÎµÎ³Ï‡Î¿Ï‚ Î±Î½ ÎºÎ¬Ï€Î¿Î¹Î¿Ï‚ ÎºÎ­ÏÎ´Î¹ÏƒÎµ
void checkWinCondition() {
    int mafiaCount = 0, citizenCount = 0;
    for (const auto &player : players) {
        if (player.alive) {
            if (player.role == "Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚") mafiaCount++;
            else citizenCount++;
        }
    }

    if (mafiaCount == 0) {
        std::cout << "\nğŸ‰ ÎŸÎ¹ Ï€Î¿Î»Î¯Ï„ÎµÏ‚ ÎºÎ­ÏÎ´Î¹ÏƒÎ±Î½! ğŸ‰\n";
        exit(0);
    } else if (mafiaCount >= citizenCount) {
        std::cout << "\nğŸ˜ˆ ÎŸÎ¹ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Î¹ ÎºÎ­ÏÎ´Î¹ÏƒÎ±Î½! ğŸ˜ˆ\n";
        exit(0);
    }
}
