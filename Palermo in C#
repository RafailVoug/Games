using System;
using System.Collections.Generic;
using System.Linq;

class Player {
    public string Name { get; set; }
    public string Role { get; set; }
    public bool Alive { get; set; } = true;
}

class Programmm {
    static List<Player> players = new List<Player>();
    static int maxMafia = 2;
    static int maxCops = 2;
    static int numCitizens;
    static int totalPlayers;
    static Random rng = new Random();

    static bool IsNameUnique(string name) {
        return !players.Any(p => p.Name == name);
    }

    static void SetupPlayers() {
        Console.OutputEncoding = System.Text.Encoding.UTF8;

        Console.Write("Î ÏŒÏƒÎ¿Î¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ Î¸Î± Ï€Î±Î¯Î¾Î¿Ï…Î½; ");
        totalPlayers = int.Parse(Console.ReadLine());
        while (totalPlayers < (maxMafia + maxCops + 1)) {
            Console.WriteLine($"Î§ÏÎµÎ¹Î¬Î¶Î¿Î½Ï„Î±Î¹ Ï„Î¿Ï…Î»Î¬Ï‡Î¹ÏƒÏ„Î¿Î½ {maxMafia + maxCops + 1} Ï€Î±Î¯ÎºÏ„ÎµÏ‚.");
            Console.Write("Î”ÏÏƒÎµ Î¾Î±Î½Î¬: ");
            totalPlayers = int.Parse(Console.ReadLine());
        }

        players.Clear();
        for (int i = 0; i < totalPlayers; i++) {
            Console.Write($"ÎŒÎ½Î¿Î¼Î± Ï€Î±Î¯ÎºÏ„Î· {i + 1}: ");
            string name = Console.ReadLine();
            while (!IsNameUnique(name)) {
                Console.Write("Î¤Î¿ ÏŒÎ½Î¿Î¼Î± Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î®Î´Î·. Î”ÏÏƒÎµ Î¬Î»Î»Î¿: ");
                name = Console.ReadLine();
            }
            players.Add(new Player { Name = name });
        }

        numCitizens = totalPlayers - maxMafia - maxCops;
    }

    static void AssignRoles() {
        List<string> roles = new List<string>();
        roles.AddRange(Enumerable.Repeat("Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚", maxMafia));
        roles.AddRange(Enumerable.Repeat("Î‘ÏƒÏ„Ï…Î½Î¿Î¼Î¹ÎºÏŒÏ‚", maxCops));
        roles.AddRange(Enumerable.Repeat("Î Î¿Î»Î¯Ï„Î·Ï‚", numCitizens));

        roles = roles.OrderBy(_ => rng.Next()).ToList();

        for (int i = 0; i < players.Count; i++) {
            players[i].Role = roles[i];
        }

        Console.WriteLine("\nÎŸÎ¹ ÏÏŒÎ»Î¿Î¹ Î±Î½Î±Ï„Î­Î¸Î·ÎºÎ±Î½. ÎŸ ÎºÎ±Î¸Î­Î½Î±Ï‚ Î²Î»Î­Ï€ÎµÎ¹ Î¼Ï…ÏƒÏ„Î¹ÎºÎ¬ Ï„Î¿Î½ ÏÏŒÎ»Î¿ Ï„Î¿Ï…:");
        foreach (var p in players) {
            Console.WriteLine($"{p.Name}, Ï€Î¬Ï„Î± Enter Î³Î¹Î± Î½Î± Î´ÎµÎ¹Ï‚ Ï„Î¿Î½ ÏÏŒÎ»Î¿ ÏƒÎ¿Ï…...");
            Console.ReadLine();
            Console.WriteLine($"ÎŸ ÏÏŒÎ»Î¿Ï‚ ÏƒÎ¿Ï… ÎµÎ¯Î½Î±Î¹: {p.Role}");
            Console.WriteLine("(Ï€Î¬Ï„Î± Enter Î³Î¹Î± Î½Î± ÏƒÏ…Î½ÎµÏ‡Î¯ÏƒÎµÎ¹ Î¿ ÎµÏ€ÏŒÎ¼ÎµÎ½Î¿Ï‚)");
            Console.ReadLine();
            Console.Clear();
        }
    }

    static int FindPlayerIndexByName(string name) {
        for (int i = 0; i < players.Count; i++) {
            if (players[i].Name == name && players[i].Alive)
                return i;
        }
        return -1;
    }

    static void NightPhase() {
        Console.WriteLine("\nğŸŒ™ ÎÏÏ‡Ï„Î± Ï€Î­Ï†Ï„ÎµÎ¹ ÏƒÏ„Î¿ Ï‡Ï‰ÏÎ¹ÏŒ...");
        var mafiaNames = players.Where(p => p.Alive && p.Role == "Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚").Select(p => p.Name).ToList();

        Console.WriteLine($"ÎŸÎ¹ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Î¹ ({mafiaNames.Count}) Î±Ï€Î¿Ï†Î±ÏƒÎ¯Î¶Î¿Ï…Î½ Ï€Î¿Î¹Î¿Î½ Î½Î± ÏƒÎºÎ¿Ï„ÏÏƒÎ¿Ï…Î½:");
        foreach (var name in mafiaNames) {
            string victim;
            int victimIndex;
            do {
                Console.Write($"{name}, Ï€Î¿Î¹Î¿Î½ Î¸ÎµÏ‚ Î½Î± ÏƒÎºÎ¿Ï„ÏÏƒÎµÎ¹Ï‚; ");
                victim = Console.ReadLine();
                victimIndex = FindPlayerIndexByName(victim);
            } while (victimIndex == -1 || players[victimIndex].Role == "Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚" || !players[victimIndex].Alive);

            players[victimIndex].Alive = false;
            Console.WriteLine($"ÎŸ Ï€Î±Î¯ÎºÏ„Î·Ï‚ {players[victimIndex].Name} ÏƒÎºÎ¿Ï„ÏÎ¸Î·ÎºÎµ Î¼Î­ÏƒÎ± ÏƒÏ„Î· Î½ÏÏ‡Ï„Î±!");
            break; // Î¼ÏŒÎ½Î¿ Î­Î½Î±Ï‚ ÏƒÎºÎ¿Ï„ÏÎ½ÎµÏ„Î±Î¹
        }
    }

    static void DayPhase() {
        Console.WriteLine("\nâ˜€ï¸ ÎœÎ­ÏÎ± Î¾Î·Î¼Î­ÏÏ‰ÏƒÎµ ÏƒÏ„Î¿ Ï‡Ï‰ÏÎ¹ÏŒ...\nÎŸÎ¹ Ï€Î±Î¯ÎºÏ„ÎµÏ‚ ÏƒÏ…Î¶Î·Ï„Î¿ÏÎ½ ÎºÎ±Î¹ ÏˆÎ·Ï†Î¯Î¶Î¿Ï…Î½ Ï€Î¿Î¹Î¿Î½ Î½Î± Î´Î¹ÏÎ¾Î¿Ï…Î½:");
        var voteCounts = new Dictionary<string, int>();

        foreach (var p in players) {
            if (!p.Alive) continue;
            string vote;
            int voteIndex;
            do {
                Console.Write($"{p.Name}, Ï€Î¿Î¹Î¿Î½ ÏˆÎ·Ï†Î¯Î¶ÎµÎ¹Ï‚; ");
                vote = Console.ReadLine();
                voteIndex = FindPlayerIndexByName(vote);
            } while (voteIndex == -1 || !players[voteIndex].Alive || vote == p.Name);

            if (!voteCounts.ContainsKey(vote))
                voteCounts[vote] = 0;
            voteCounts[vote]++;
        }

        var eliminated = "";
        int maxVotes = 0;
        foreach (var pair in voteCounts) {
            if (pair.Value > maxVotes) {
                maxVotes = pair.Value;
                eliminated = pair.Key;
            }
        }

        if (eliminated != "") {
            int idx = FindPlayerIndexByName(eliminated);
            players[idx].Alive = false;
            Console.WriteLine($"\nÎŸ Ï€Î±Î¯ÎºÏ„Î·Ï‚ {eliminated} Î±Ï€Î¿Ï‡ÏÏÎ·ÏƒÎµ Î±Ï€ÏŒ Ï„Î¿ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹!");
        } else {
            Console.WriteLine("Î™ÏƒÎ¿ÏˆÎ·Ï†Î¯Î±! ÎšÎ±Î½ÎµÎ¯Ï‚ Î´ÎµÎ½ Ï†ÎµÏÎ³ÎµÎ¹ ÏƒÎ®Î¼ÎµÏÎ±.");
        }
    }

    static bool CheckVictory() {
        int mafia = 0, others = 0;
        foreach (var p in players) {
            if (!p.Alive) continue;
            if (p.Role == "Î”Î¿Î»Î¿Ï†ÏŒÎ½Î¿Ï‚") mafia++;
            else others++;
        }

        if (mafia == 0) {
            Console.WriteLine("\nğŸ‰ ÎŸÎ¹ Ï€Î¿Î»Î¯Ï„ÎµÏ‚ ÎºÎ­ÏÎ´Î¹ÏƒÎ±Î½! ÎŸÎ¹ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Î¹ ÎµÎ¾Î¿Î½Ï„ÏÎ¸Î·ÎºÎ±Î½!");
            return true;
        }
        if (mafia >= others) {
            Console.WriteLine("\nğŸ’€ ÎŸÎ¹ Î´Î¿Î»Î¿Ï†ÏŒÎ½Î¿Î¹ ÎºÎ­ÏÎ´Î¹ÏƒÎ±Î½! Î•Ï€Î¹ÎºÏÎ¬Ï„Î·ÏƒÎ±Î½ ÏƒÏ„Î¿ Ï‡Ï‰ÏÎ¹ÏŒ!");
            return true;
        }
        return false;
    }

    static void Main() {
        Console.OutputEncoding = System.Text.Encoding.UTF8;
        Console.InputEncoding = System.Text.Encoding.UTF8;

        Console.WriteLine("ğŸ­ ÎšÎ±Î»ÏÏ‚ Î®ÏÎ¸ÎµÏ‚ ÏƒÏ„Î¿ Î´Î¹Î±Î´ÏÎ±ÏƒÏ„Î¹ÎºÏŒ Ï€Î±Î¹Ï‡Î½Î¯Î´Î¹ ÎœÎ¬Ï†Î¹Î±!");
        SetupPlayers();
        AssignRoles();

        bool gameOver = false;
        while (!gameOver) {
            NightPhase();
            if ((gameOver = CheckVictory())) break;
            DayPhase();
            if ((gameOver = CheckVictory())) break;
        }

        Console.WriteLine("\nğŸ® Î¤Î­Î»Î¿Ï‚ Ï€Î±Î¹Ï‡Î½Î¹Î´Î¹Î¿Ï!");
    }
}
